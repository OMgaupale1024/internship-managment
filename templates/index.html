{% extends 'layout.html' %}
{% block content %}
  {% if not session.get('user') %}
  <!-- Hero Section -->
  <div class="px-4 py-5 my-5 text-center">
    <h1 class="display-5 fw-bold text-primary mb-4">Internship Management System</h1>
    <div class="col-lg-6 mx-auto">
      <p class="lead mb-4">Connecting talented students with great companies for meaningful internship opportunities.</p>
      <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
        <a href="/login" class="btn btn-primary btn-lg px-4 gap-3">Login</a>
        <a href="/register" class="btn btn-outline-primary btn-lg px-4">Register</a>
      </div>
    </div>
  </div>

  <!-- Features -->
  <div class="container px-4 py-5">
    <h2 class="pb-2 text-center">Why Choose Us?</h2>
    <div class="row g-4 py-5 row-cols-1 row-cols-lg-3">
      <div class="col d-flex align-items-start">
        <div class="icon-square text-bg-light d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
          <i class="fa-solid fa-graduation-cap"></i>
        </div>
        <div>
          <h3 class="fs-5">For Students</h3>
          <p>Find and apply to internships that match your skills and career goals. Track your applications and submit reports easily.</p>
        </div>
      </div>
      <div class="col d-flex align-items-start">
        <div class="icon-square text-bg-light d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
          <i class="fa-solid fa-building"></i>
        </div>
        <div>
          <h3 class="fs-5">For Companies</h3>
          <p>Post internship opportunities, manage applications, and rate intern performance all in one place.</p>
        </div>
      </div>
      <div class="col d-flex align-items-start">
        <div class="icon-square text-bg-light d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
          <i class="fa-solid fa-chart-line"></i>
        </div>
        <div>
          <h3 class="fs-5">Analytics & Insights</h3>
          <p>Get detailed analytics and reports on internship programs, student performance, and placement rates.</p>
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <!-- Dashboard Overview for Logged In Users -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card highlight-card">
        <div class="card-body p-4">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <h3 class="card-title mb-2">Welcome back, {{ session.get('user') }}!</h3>
              <p class="text-muted mb-0">
                <i class="fa-solid fa-user-tag me-2"></i>
                {{ session.get('role')|title }} Dashboard
              </p>
            </div>
            <div class="text-end">
              <div class="badge bg-primary fs-6 px-3 py-2">
                <i class="fa-solid fa-calendar-day me-2"></i>Today
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-stats">
    {% if role == 'admin' %}
    <div class="stat-card">
      <div class="stat-card-icon primary">
        <i class="fa-solid fa-graduation-cap"></i>
      </div>
      <h3 class="mb-1">{{ students|length }}</h3>
      <p class="text-muted mb-2">Active Students</p>
      <a href="/students" class="btn btn-sm btn-outline-primary">
        <i class="fa-solid fa-arrow-right me-1"></i>Manage
      </a>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon success">
        <i class="fa-solid fa-building"></i>
      </div>
      <h3 class="mb-1">{{ companies|length }}</h3>
      <p class="text-muted mb-2">Registered Companies</p>
      <a href="/companies" class="btn btn-sm btn-outline-success">
        <i class="fa-solid fa-arrow-right me-1"></i>Manage
      </a>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon info">
        <i class="fa-solid fa-briefcase"></i>
      </div>
      <h3 class="mb-1">{{ internships|length }}</h3>
      <p class="text-muted mb-2">Open Internships</p>
      <a href="/internships" class="btn btn-sm btn-outline-info">
        <i class="fa-solid fa-arrow-right me-1"></i>Manage
      </a>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
        <i class="fa-solid fa-file-alt"></i>
      </div>
      <h3 class="mb-1">{{ applications|length }}</h3>
      <p class="text-muted mb-2">Total Applications</p>
      <a href="/applications" class="btn btn-sm btn-outline-danger">
        <i class="fa-solid fa-arrow-right me-1"></i>View All
      </a>
    </div>
    {% elif role == 'company' %}
    <div class="stat-card">
      <div class="stat-card-icon info">
        <i class="fa-solid fa-briefcase"></i>
      </div>
      <h3 class="mb-1">{{ internships|length }}</h3>
      <p class="text-muted mb-2">Posted Internships</p>
      <a href="/internships" class="btn btn-sm btn-outline-info">
        <i class="fa-solid fa-arrow-right me-1"></i>Manage
      </a>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon success">
        <i class="fa-solid fa-file-alt"></i>
      </div>
      <h3 class="mb-1">{{ applications|length }}</h3>
      <p class="text-muted mb-2">Applications Received</p>
      <a href="/applications" class="btn btn-sm btn-outline-success">
        <i class="fa-solid fa-arrow-right me-1"></i>View All
      </a>
    </div>
    {% else %}
    <div class="stat-card">
      <div class="stat-card-icon info">
        <i class="fa-solid fa-briefcase"></i>
      </div>
      <h3 class="mb-1">{{ internships|length }}</h3>
      <p class="text-muted mb-2">Available Internships</p>
      <a href="/internships" class="btn btn-sm btn-outline-info">
        <i class="fa-solid fa-search me-1"></i>Browse
      </a>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon success">
        <i class="fa-solid fa-file-alt"></i>
      </div>
      <h3 class="mb-1">{{ applications|length }}</h3>
      <p class="text-muted mb-2">My Applications</p>
      <a href="/applications" class="btn btn-sm btn-outline-success">
        <i class="fa-solid fa-arrow-right me-1"></i>View All
      </a>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon primary">
        <i class="fa-solid fa-building"></i>
      </div>
      <h3 class="mb-1">{{ companies|length }}</h3>
      <p class="text-muted mb-2">Registered Companies</p>
      <a href="/companies" class="btn btn-sm btn-outline-primary">
        <i class="fa-solid fa-arrow-right me-1"></i>View All
      </a>
    </div>
    {% endif %}
  </div>

  {% if applications %}
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">
        <i class="fa-solid fa-clock-rotate-left me-2"></i>Recent Applications
      </h5>
    </div>
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            {% if role == 'admin' %}
            <th>Student</th>
            {% endif %}
            {% if role == 'company' %}
            <th>Student</th>
            {% endif %}
            <th>Internship</th>
            {% if role == 'admin' or role == 'company' %}
            <th>Company</th>
            {% endif %}
            <th>Status</th>
            <th>Applied At</th>
            {% if role == 'admin' or role == 'company' %}
            <th>Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for a in applications[:10] %}
          <tr>
            {% if role == 'admin' %}
            <td><strong>{{ a.student_name or 'N/A' }}</strong></td>
            {% endif %}
            {% if role == 'company' %}
            <td><strong>{{ a.student_name or 'N/A' }}</strong></td>
            {% endif %}
            <td>{{ a.internship_title or 'N/A' }}</td>
            {% if role == 'admin' %}
            <td>{{ a.company_name or 'N/A' }}</td>
            {% endif %}
            <td>
              <span class="badge bg-{{ 'success' if a.status == 'Selected' else ('danger' if a.status == 'Rejected' else ('warning' if a.status == 'Under Review' else 'primary')) }}">
                {{ a.status }}
              </span>
            </td>
            <td>{{ a.applied_at.strftime('%b %d, %Y') if a.applied_at else 'N/A' }}</td>
            {% if role == 'admin' or role == 'company' %}
            <td>
              <a href="/applications" class="btn btn-sm btn-outline-primary">
                <i class="fa-solid fa-eye"></i>
              </a>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
          {% if applications|length == 0 %}
          <tr>
            <td colspan="6" class="text-center text-muted py-4">
              <i class="fa-solid fa-inbox fa-2x mb-2 d-block"></i>
              No applications yet
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
  {% endif %}
{% endblock %}
