{% extends 'layout.html' %}
{% block content %}
  <h3>Database Browser</h3>
  <p class="text-muted">Below are the tables in the configured database with a small sample of rows (up to 5).</p>
  <div class="row gy-3">
    {% for t in tables %}
    <div class="col-md-6">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <strong>{{ t.table }}</strong>
            <div class="text-muted small">Approx rows: {{ t.rows }}</div>
          </div>
          <a class="btn btn-sm btn-outline-secondary" href="/api/table_sample/{{ t.table }}?limit=100" target="_blank">Open (sample)</a>
        </div>
        <div class="card-body p-2">
          {% if t.columns %}
            <div class="table-responsive" style="max-height:220px;overflow:auto;">
              <table class="table table-sm table-striped mb-0">
                <thead>
                  <tr>
                    {% for c in t.columns %}
                      <th>{{ c.column_name }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  {% if t.sample and t.sample|length > 0 %}
                    {% for row in t.sample %}
                      <tr>
                        {% for c in t.columns %}
                          <td>{{ row[c.column_name] }}</td>
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  {% else %}
                    <tr><td colspan="{{ t.columns|length }}"><em>No data</em></td></tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-muted">Unable to fetch columns for this table.</div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
{% endblock %}